(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7945b74c"],{"746a":function(e,t,a){},f715:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"picture"},[a("div",{staticClass:"pic"},[a("div",{staticClass:"picLeft"},[a("picture-item",{attrs:{data1:e.category}})],1),a("div",{staticClass:"picRight"})]),a("el-dialog",{attrs:{title:"图片上传",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",[a("el-form",{ref:"upload",attrs:{"label-width":"auto"}},[a("el-form-item",{attrs:{label:"图片描述"}},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.upload.description,expression:"upload.description"}],staticStyle:{resize:"none"},attrs:{cols:"60",rows:"5"},domProps:{value:e.upload.description},on:{input:function(t){t.target.composing||e.$set(e.upload,"description",t.target.value)}}})]),a("el-form-item",{attrs:{label:"图片标签"}},[a("el-input",{staticStyle:{width:"300px"},model:{value:e.upload.label,callback:function(t){e.$set(e.upload,"label",t)},expression:"upload.label"}})],1),a("el-form-item",{attrs:{label:"图片归档id值"}},[a("el-input-number",{staticClass:"tip11",attrs:{min:0,label:"每次上传图片归档id值不能有重复"},on:{change:e.handleChange},model:{value:e.upload.doc_id,callback:function(t){e.$set(e.upload,"doc_id",t)},expression:"upload.doc_id"}})],1),a("el-form-item",{attrs:{label:"分类"}},[a("el-select",{attrs:{filterable:"",placeholder:"类别选择"},model:{value:e.upload.classify,callback:function(t){e.$set(e.upload,"classify",t)},expression:"upload.classify"}},e._l(e.category,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.name}})})),1),e._v("\n\n          自定义类别：\n          "),a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入类别名","suffix-icon":"el-icon-plus"},model:{value:e.upload.classify,callback:function(t){e.$set(e.upload,"classify",t)},expression:"upload.classify"}})],1),a("el-upload",{staticClass:"upload-demo",attrs:{drag:"",name:"file","show-file-list":"","on-success":e.success,multiple:"",data:e.upload,"on-error":e.error,"before-upload":e.beforeUpload,accept:"image/png, image/jpeg, image/gif, image/jpg, image/bmp",action:"/api/fileSubmit"},scopedSlots:e._u([{key:"tip",fn:function(){return[a("div",{staticClass:"el-upload__tip"},[e._v("\n              支持多文件上传"),a("em",{staticStyle:{color:"#21a366"}},[e._v("\n                支持png,bmp,jpg,jpeg,gif格式")])])]},proxy:!0}])},[a("i",{staticClass:"el-icon-upload"}),a("div",{staticClass:"el-upload__text"},[e._v("\n            将文件拖到此处，或"),a("em",[e._v("点击上传")])])])],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")])],1)]),a("div",{staticClass:"lib"},[a("div",{staticClass:"handle-box"},[a("el-button",{staticClass:"handle-del mr10",attrs:{type:"danger",icon:"el-icon-delete"},on:{click:e.delAllSelection}},[e._v("批量删除")]),a("el-select",{staticClass:"handle-select mr10",staticStyle:{"margin-left":"10px"},attrs:{placeholder:"图库类别"},model:{value:e.search.category,callback:function(t){e.$set(e.search,"category",t)},expression:"search.category"}},[a("el-option",{key:"100",attrs:{label:"全部",value:"全部"}}),e._l(e.category,(function(e){return a("el-option",{key:e,attrs:{label:e.name,value:e.name}})}))],2),a("el-button",{staticStyle:{"margin-left":"30px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("搜索")]),e._v("\n      每页数量\n      "),a("el-input-number",{attrs:{step:1,"step-strictly":""},model:{value:e.query.pageSize,callback:function(t){e.$set(e.query,"pageSize",t)},expression:"query.pageSize"}}),a("el-button",{staticStyle:{"margin-left":"30px"},attrs:{type:"success",icon:"el-icon-upload"},on:{click:function(t){return e.upload2()}}},[e._v("上传图片")]),a("el-button",{staticStyle:{"margin-left":"30px"},attrs:{type:"warning",icon:"el-icon-download"},on:{click:function(t){return e.generate()}}},[e._v("导出EXCEL")])],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,id:"excel0"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),a("el-table-column",{attrs:{label:"阅览",width:"180"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{content:"点我阅览大图哦！",placement:"bottom",effect:"light"}},[a("el-image",{staticStyle:{width:"100px",height:"100px"},attrs:{src:e.row.file_path,"preview-src-list":[e.row.file_path]}})],1)]}}])}),a("el-table-column",{attrs:{label:"日期",width:"180",prop:"time"}}),a("el-table-column",{attrs:{label:"分类",width:"100",prop:"classify"}}),a("el-table-column",{attrs:{label:"链接",width:"180",prop:"file_path"}}),a("el-table-column",{attrs:{label:"类型",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"medium",type:"warning"}},[e._v(e._s(t.row.file_type))])],1)]}}])}),a("el-table-column",{attrs:{label:"标签",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[a("el-tag",{attrs:{size:"medium"}},[e._v(e._s(t.row.user_defined_label))])],1)]}}])}),a("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return e.DownloadImg(t.row.file_path)}}},[e._v("下载")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"page"},[a("el-pagination",{attrs:{"current-page":e.query.pageIndex,"page-sizes":[10,50,100,200],"page-size":e.query.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.query.count},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1)},l=[],i=(a("28a5"),a("6b54"),a("87b3"),a("386d"),function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)}),n=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{width:"100%",height:"400px"},attrs:{id:"picture"}})])}],s=(a("7f7f"),a("313e")),c={props:["data1"],data:function(){return{}},methods:{getTime:function(){var e=new Date,t="-",a=e.getFullYear(),o=e.getMonth()+1,l=e.getDate();o>=1&&o<=9&&(o="0"+o),l>=0&&l<=9&&(l="0"+l);var i=a+t+o+t+l;return i},tu:function(){for(var e=s["init"](document.getElementById("picture")),t=[],a=0;a<this.data1.length;a++)t[a]={value:this.data1[a].count,name:this.data1[a].name};console.log("okkkk"),console.log(t),e.setOption({title:{text:"图库类别实时统计",subtext:this.getTime(),left:"center"},tooltip:{trigger:"item"},legend:{orient:"horizontal",left:"center",bottom:"bottom"},series:[{name:"数量",type:"pie",radius:"50%",data:t,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})}},mounted:function(){var e=this;console.log("接受数据-------"),console.log(this.data1),this.tu();var t=s["init"](document.getElementById("picture")),a=0;this.time=setInterval((function(){for(var o=[],l=0;l<e.data1.length;l++)o[l]={value:e.data1[l].count,name:e.data1[l].name};if(console.log("okkkk"),console.log(o),t.setOption({title:{text:"资源分类实时统计",subtext:e.getTime(),left:"center"},tooltip:{trigger:"item"},legend:{orient:"horizontal",left:"center",bottom:"bottom"},series:[{name:"数量",type:"pie",radius:"50%",data:o,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),100==a)return 0;console.log(a),a+=1}),1e3)}},r=c,u=a("2877"),d=Object(u["a"])(r,i,n,!1,null,null,null),g=d.exports,p={components:{PictureItem:g},data:function(){return{dialogFormVisible:!1,search:{category:"全部",question:null},upload:{description:"",label:"",classify:"",user:"admin",doc_id:0},tableData:[],query:{pageIndex:1,pageSize:10,count:100},category:[],multipleSelection:[]}},methods:{upload2:function(){this.dialogFormVisible=!0},getPictureList:function(){var e=this;this.$axios.get("/getPictureList",{params:{page:this.query.pageIndex,eachPageNum:this.query.pageSize}}).then((function(t){e.tableData=t.data.data,console.log(e.tableData)})).catch((function(e){console.log(e)}))},getSearchData:function(){var e=this;this.$axios.get("/getSearchPicture",{params:{category:this.search.category,page:this.query.pageIndex,eachPageNum:this.query.pageSize}}).then((function(t){e.tableData=t.data.data,console.log(t.data)})).catch((function(e){console.log(e)}))},handleSearch:function(){this.getSearchData()},getPictureCategory:function(){var e=this;this.$axios.get("/getPictureCategory").then((function(t){e.category=t.data.category,e.query.count=t.data.total,console.log(e.category)})).catch((function(e){console.log(e)}))},handleDelete:function(e,t){var a=this;console.log(e),console.log(t),this.$confirm("确定要删除吗？","提示",{type:"warning"}).then((function(){var o=[t.id];a.delSingleSelection(o),a.tableData.splice(e,1)})).catch((function(){}))},handleSelectionChange:function(e){this.multipleSelection=e},generate:function(){var e=new Date;this.$htmlToExcel.getExcel("#excel0",e.getFullYear().toString()+e.getMonth().toString()+e.getDate().toString()+e.getDay().toString()+e.getHours().toString()+e.getMinutes().toString()+e.getSeconds().toString())},handleChange:function(){var e=this;this.$axios("/ruler?doc_id="+this.upload.doc_id).then((function(t){console.log(t.data),1==t.data?(e.$message.error("该图片归类id值已经存在，请重新输入!"),document.querySelector(".tip11").style.border="1px solid red"):document.querySelector(".tip11").style.border=""}))},delSingleSelection:function(e){var t=this;console.log(e),this.$axios({method:"post",url:"/delPicture",headers:{"content-type":"application/json"},data:e}).then((function(e){console.log(e.data),t.$message.error(e.data.msg),t.getData()})).catch((function(e){console.log(e)}))},getTime:function(){var e=new Date,t="-",a=e.getFullYear(),o=e.getMonth()+1,l=e.getDate();o>=1&&o<=9&&(o="0"+o),l>=0&&l<=9&&(l="0"+l);var i=a+t+o+t+l;return i},DownloadImg:function(e){var t=e.split("/")[e.split("/").length-1],a=new Image;a.setAttribute("crossOrigin","anonymous"),a.onload=function(){var e=document.createElement("canvas");e.width=a.width,e.height=a.height;var o=e.getContext("2d");o.drawImage(a,0,0,a.width,a.height);var l=e.toDataURL("image/png"),i=document.createElement("a"),n=new MouseEvent("click");i.download=t||"photo",i.href=l,i.dispatchEvent(n)},a.src=e},success:function(e,t,a){200==e.code?this.$message({message:"上传成功！",type:"success"}):this.$message.error("服务器程序异常！"),console.log(t),console.log(a)},error:function(e,t,a){this.$message.error(e),console.log(t),console.log(a)},beforeUpload:function(e,t){console.log(e),console.log(t)},delAllSelection:function(){var e=this;console.log(this.multipleSelection);for(var t=new Array(this.multipleSelection.length),a=0;a<this.multipleSelection.length;a++)t[a]=this.multipleSelection[a].id;this.tableData.splice(0,this.query.pageSize),console.log("哈"),console.log(t),this.$axios({method:"post",url:"/delPicture",headers:{"content-type":"application/json"},data:t}).then((function(t){console.log(t.data),e.$message.error(t.data.msg),e.getPictureList(),e.getPictureCategory()})).catch((function(e){console.log(e)}))},handleCurrentChange:function(e){this.query.pageIndex=e,this.getPictureList()},handleSizeChange:function(e){this.query.pageSize=e,this.getPictureList(),console.log("每页 ".concat(e," 条"))}},created:function(){this.getPictureList(),this.getPictureCategory()}},h=p,m=(a("ffce"),Object(u["a"])(h,o,l,!1,null,null,null));t["default"]=m.exports},ffce:function(e,t,a){"use strict";a("746a")}}]);